<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–∞–¥–µ–±–Ω—ã—Ö —Ñ–æ—Ç–æ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #d63384; }
        .back-btn { display: inline-block; margin: 10px; padding: 10px 20px; background: #2196F3; color: white; text-decoration: none; border-radius: 50px; }
        .photo-container { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .photo-info { margin-bottom: 15px; }
        .photo-img { width: 100%; border-radius: 10px; margin: 15px 0; }
        .actions { display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .download-btn { background: #4CAF50; color: white; }
        .delete-btn { background: #f44336; color: white; }
        .empty-state { text-align: center; padding: 50px; color: #666; }
        .all-photos { margin-top: 30px; }
        .photo-item { background: white; padding: 15px; margin: 10px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∏ –ì–∞–ª–µ—Ä–µ—è —Å–≤–∞–¥–µ–±–Ω—ã—Ö —Ñ–æ—Ç–æ</h1>
            <p>–í—Å–µ —Ñ–æ—Ç–æ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≥–æ—Å—Ç—è–º–∏</p>
            <a href="index.html" class="back-btn">‚Üê –°–¥–µ–ª–∞—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ</a>
            <button onclick="clearAllPhotos()" style="background: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
            </button>
        </header>
        
        <div id="singlePhoto"></div>
        <div id="allPhotos" class="all-photos"></div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º ID —Ñ–æ—Ç–æ –∏–∑ URL (–µ—Å–ª–∏ –µ—Å—Ç—å #)
        const photoId = window.location.hash.substring(1);
        const singlePhotoDiv = document.getElementById('singlePhoto');
        const allPhotosDiv = document.getElementById('allPhotos');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ñ–æ—Ç–æ
        let allPhotos = JSON.parse(localStorage.getItem('wedding_photos') || '[]');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–¥–Ω–æ —Ñ–æ—Ç–æ –∏–ª–∏ –≤—Å–µ —Ñ–æ—Ç–æ
        if (photoId) {
            showSinglePhoto(photoId);
        } else {
            showAllPhotos();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ
        function showSinglePhoto(id) {
            const photo = allPhotos.find(p => p.id === id);
            
            if (!photo) {
                singlePhotoDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–í–æ–∑–º–æ–∂–Ω–æ –æ–Ω–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ</p>
                        <a href="view.html" class="back-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ</a>
                    </div>
                `;
                return;
            }
            
            singlePhotoDiv.innerHTML = `
                <div class="photo-container">
                    <div class="photo-info">
                        <h3>üë∞ ${photo.name}</h3>
                        <p>üìÖ ${photo.time}</p>
                        <p>üì± ${photo.device || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'}</p>
                    </div>
                    <img src="${photo.photoDataUrl}" alt="–°–≤–∞–¥–µ–±–Ω–æ–µ —Ñ–æ—Ç–æ" class="photo-img">
                    <div class="actions">
                        <button class="download-btn" onclick="downloadPhoto('${id}')">üíæ –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ</button>
                        <button class="delete-btn" onclick="deletePhoto('${id}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        <button onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            `;
            
            // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–æ—Ç–æ
            allPhotosDiv.style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≤—Å–µ—Ö —Ñ–æ—Ç–æ
        function showAllPhotos() {
            if (allPhotos.length === 0) {
                allPhotosDiv.innerHTML = `
                    <div class="empty-state">
                        <h3>üòî –ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ</h3>
                        <p>–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ!</p>
                        <a href="index.html" class="back-btn">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</a>
                    </div>
                `;
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            allPhotos.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let html = '<h2>–í—Å–µ —Ñ–æ—Ç–æ (${allPhotos.length}):</h2>';
            
            allPhotos.forEach(photo => {
                html += `
                    <div class="photo-item">
                        <div>
                            <strong>${photo.name}</strong><br>
                            <small>${photo.time}</small>
                        </div>
                        <div>
                            <button onclick="viewPhoto('${photo.id}')" style="background: #2196F3; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 5px;">
                                üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                            </button>
                            <button onclick="deletePhoto('${photo.id}')" style="background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                `;
            });
            
            allPhotosDiv.innerHTML = html;
            singlePhotoDiv.style.display = 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏
        function viewPhoto(id) {
            window.location.hash = id;
            location.reload();
        }
        
        function downloadPhoto(id) {
            const photo = allPhotos.find(p => p.id === id);
            if (!photo) return;
            
            const link = document.createElement('a');
            link.href = photo.photoDataUrl;
            link.download = `—Å–≤–∞–¥–µ–±–Ω–æ–µ_—Ñ–æ—Ç–æ_${photo.name}_${photo.time.replace(/[^\d]/g, '-')}.jpg`;
            link.click();
            
            alert('üì• –§–æ—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è!');
        }
        
        function deletePhoto(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ?')) return;
            
            allPhotos = allPhotos.filter(p => p.id !== id);
            localStorage.setItem('wedding_photos', JSON.stringify(allPhotos));
            
            alert('üóëÔ∏è –§–æ—Ç–æ —É–¥–∞–ª–µ–Ω–æ!');
            location.reload();
        }
        
        function clearAllPhotos() {
            if (!confirm('–£–î–ê–õ–ò–¢–¨ –í–°–ï –§–û–¢–û? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            localStorage.removeItem('wedding_photos');
            alert('‚úÖ –í—Å–µ —Ñ–æ—Ç–æ —É–¥–∞–ª–µ–Ω—ã!');
            location.reload();
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ hash
        window.addEventListener('hashchange', () => {
            location.reload();
        });
    </script>
</body>
</html>
