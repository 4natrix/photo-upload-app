<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–≤–∞–¥–µ–±–Ω–æ–µ —Ñ–æ—Ç–æ</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –±—ã–ª–∏ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial; }
        body { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: white; border-radius: 25px; padding: 30px; width: 100%; max-width: 500px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); border: 8px solid gold; text-align: center; }
        h1 { color: #d63384; margin-bottom: 10px; }
        video, img { width: 100%; border-radius: 15px; display: none; }
        video { background: #000; transform: scaleX(-1); }
        img { border: 5px solid #4CAF50; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px 0; }
        button { padding: 18px; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        #startBtn { background: #2196F3; color: white; grid-column: span 2; }
        #captureBtn { background: #FF9800; color: white; display: none; }
        #retakeBtn { background: #757575; color: white; display: none; }
        #sendBtn { background: #4CAF50; color: white; grid-column: span 2; display: none; }
        .status { margin: 20px 0; padding: 15px; border-radius: 10px; font-weight: bold; display: none; }
        .success { background: #d4edda; color: #155724; border: 2px solid #4CAF50; }
        .error { background: #f8d7da; color: #721c24; border: 2px solid #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíç –°–≤–∞–¥–µ–±–Ω–æ–µ –§–æ—Ç–æ</h1>
        
        <video id="video" autoplay playsinline></video>
        <img id="photo" alt="–í–∞—à–µ —Ñ–æ—Ç–æ">
        
        <div class="controls">
            <button id="startBtn">üé• –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É</button>
            <button id="captureBtn">üì∏ –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
            <button id="retakeBtn">üîÑ –ü–µ—Ä–µ—Å–Ω—è—Ç—å</button>
            <button id="sendBtn">‚úàÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
        
        <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="width:100%; padding:15px; margin:10px 0; border-radius:50px; border:3px solid #FFD700; display:none;">
        
        <div id="status" class="status"></div>
    </div>

    <script>
        // üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        // 1. –ö–ª—é—á ImgBB (—Ä–∞–±–æ—á–∏–π)
        const IMGBB_KEY = 'a916539d20d3887f9b444a206968d4f2';
        
        // 2. –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô URL –û–¢ FORMSPREE
        // –ü–æ–ª—É—á–∏ –Ω–∞ formspree.io –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        const FORMSPREE_URL = 'https://formspree.io/f/mreepgwk';
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const video = document.getElementById('video');
        const photo = document.getElementById('photo');
        const startBtn = document.getElementById('startBtn');
        const captureBtn = document.getElementById('captureBtn');
        const retakeBtn = document.getElementById('retakeBtn');
        const sendBtn = document.getElementById('sendBtn');
        const nameInput = document.getElementById('name');
        const statusDiv = document.getElementById('status');
        
        let stream = null;
        let photoBlob = null;
        
        // –§—É–Ω–∫—Ü–∏–∏
        function showStatus(text, type) {
            statusDiv.textContent = text;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        // 1. –í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É
       // –ó–∞–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é sendBtn.addEventListener('click', ...) –Ω–∞ —ç—Ç—É:

sendBtn.addEventListener('click', async () => {
    if (!photoBlob) return;
    
    const guestName = nameInput.value.trim() || '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –≥–æ—Å—Ç—å';
    const timestamp = new Date().toLocaleString('ru-RU');
    
    sendBtn.disabled = true;
    sendBtn.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
    showStatus('üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ...', 'success');
    
    try {
        // –ê. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ Base64
        showStatus('üì§ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ç–æ...', 'success');
        
        const reader = new FileReader();
        const photoBase64 = await new Promise((resolve) => {
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(photoBlob);
        });
        
        // –ë. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ FreeImage.Host (–±–µ–∑ –∫–ª—é—á–∞!)
        showStatus('üñºÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥...', 'success');
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º base64 –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ data:image/jpeg;base64,)
        const base64Data = photoBase64.split(',')[1];
        
        const freeImageResponse = await fetch('https://freeimage.host/api/1/upload', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                key: '6d207e02198a847aa98d0a2a901485a5', // –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
                source: base64Data,
                format: 'json'
            })
        });
        
        const freeImageData = await freeImageResponse.json();
        
        if (!freeImageData.image || !freeImageData.image.url) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ');
        }
        
        const photoUrl = freeImageData.image.url;
        console.log('‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ:', photoUrl);
        
        // –í. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Formspree
        showStatus('üì® –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...', 'success');
        
        const formData = new FormData();
        formData.append('–ò–º—è –≥–æ—Å—Ç—è', guestName);
        formData.append('–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è', timestamp);
        formData.append('–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ', photoUrl);
        formData.append('–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', navigator.userAgent.substring(0, 100));
        formData.append('_subject', `üéâ –°–≤–∞–¥–µ–±–Ω–æ–µ —Ñ–æ—Ç–æ –æ—Ç ${guestName}`);
        
        await fetch(FORMSPREE_URL, {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json'
            }
        });
        
        // –£–°–ü–ï–•
        showStatus('üéâ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å –ø–æ—á—Ç—É.', 'success');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
        setTimeout(() => {
            alert(`‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n–°—Å—ã–ª–∫–∞: ${photoUrl}\n\n–°–æ—Ö—Ä–∞–Ω–∏ —Å—Å—ã–ª–∫—É!`);
        }, 500);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
        setTimeout(() => {
            location.reload();
        }, 4000);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        showStatus('‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
        sendBtn.disabled = false;
        sendBtn.innerHTML = '‚úàÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å';
    }
});
        
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            showStatus('üëã –ù–∞–∂–º–∏ "–í–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å', 'success');
        });
    </script>
</body>
</html>



