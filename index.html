<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–≤–∞–¥–µ–±–Ω–∞—è —Ñ–æ—Ç–æ–∫–∞–±–∏–Ω–∞</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e') center/cover no-repeat;
    color: #fff;
    text-align: center;
    min-height: 100vh;
    padding: 20px;
}
.container {
    max-width: 500px;
    margin: 0 auto;
    background: rgba(0,0,0,0.5);
    padding: 20px;
    border-radius: 20px;
}
h1 {
    font-family: 'Playfair Display', serif;
    margin-bottom: 10px;
}
p {
    margin-bottom: 20px;
}
.step {
    display: none;
}
.step.active {
    display: block;
    animation: fadeIn 0.5s;
}
@keyframes fadeIn {
    from {opacity:0;} to {opacity:1;}
}
video, canvas {
    width: 100%;
    border-radius: 15px;
    margin-bottom: 15px;
}
.btn {
    background: #D4AF37;
    color: #000;
    border: none;
    padding: 15px 30px;
    border-radius: 50px;
    margin: 10px;
    font-size: 18px;
    cursor: pointer;
    transition: 0.3s;
}
.btn:hover {transform: translateY(-3px);}
.btn-red {background:#f44336;color:#fff;}
.loader {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #D4AF37;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
    display: none;
}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #D4AF37;
    color: #000;
    padding: 15px;
    border-radius: 10px;
    display: none;
    font-weight: bold;
}
.notification.error {background:#f44336;color:#fff;}
.photo-list img {width:100%;border-radius:15px;margin-bottom:10px;}
</style>
</head>
<body>

<div class="container">

<!-- –®–ê–ì 1 -->
<div id="step1" class="step active">
<h1>üì∏ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
<p>–°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ –Ω–∞ –ø–∞–º—è—Ç—å –Ω–∞—à–µ–≥–æ —Å–≤–∞–¥–µ–±–Ω–æ–≥–æ –¥–Ω—è ‚ù§Ô∏è</p>
<p>–í—ã –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ, –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è.</p>
<button class="btn" onclick="startCamera()">–ù–∞—á–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å</button>
</div>

<!-- –®–ê–ì 2 -->
<div id="step2" class="step">
<h1>üëÅÔ∏è –°—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ</h1>
<video id="video" autoplay playsinline></video>
<div>
<button class="btn" onclick="takePhoto()">üì∏ –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</button>
<button class="btn btn-red" onclick="goToStep(1)">‚Üê –ù–∞–∑–∞–¥</button>
</div>
</div>

<!-- –®–ê–ì 3 -->
<div id="step3" class="step">
<h1>üëÄ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ç–æ</h1>
<div class="photo-list" id="photoList"></div>
<input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
<textarea id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
<div>
<button class="btn" onclick="sendPhotos()" id="uploadBtn">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
<button class="btn btn-red" onclick="goToStep(2)">üîÑ –°–¥–µ–ª–∞—Ç—å –µ—â—ë —Ñ–æ—Ç–æ</button>
</div>
<div class="loader" id="loader"></div>
</div>

<!-- –®–ê–ì 4 -->
<div id="step4" class="step">
<h1>‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</h1>
<p>–°–ø–∞—Å–∏–±–æ! –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.</p>
<button class="btn" onclick="goToStep(1)">üì∏ –°–¥–µ–ª–∞—Ç—å –µ—â–µ —Ñ–æ—Ç–æ</button>
<p>–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É:</p>
<a class="btn" href="https://docs.google.com/forms/d/e/1FAIpQLSeiUNCamRqq2ixVA7objXizSqkJY1GLbPA9cn1sjnq0_TJn8Q/viewform?usp=sf_link" target="_blank">–ü–µ—Ä–µ–π—Ç–∏ –≤ —Ñ–æ—Ä–º—É</a>
</div>

</div>

<div id="notification" class="notification"></div>

<script>
// ====== –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ======
const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzFESSq5wXHO34-31ezqsuScbjiG7mtEgTAE48Xj8LgJIItDyBt-OFPCrRVJDtLnVJl7g/exec';
let currentStep=1,videoStream=null,photos=[];

// ====== –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ======
function showMsg(text,type='success'){
    const msg=document.getElementById('notification');
    msg.textContent=text;
    msg.className='notification'+(type==='error'? ' error':'');
    msg.style.display='block';
    setTimeout(()=>{msg.style.display='none';},3000);
}

// ====== –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —à–∞–≥–æ–≤ ======
function goToStep(step){
    document.querySelectorAll('.step').forEach(el=>el.classList.remove('active'));
    document.getElementById(`step${step}`).classList.add('active');
    currentStep=step;
    if(step!==2 && videoStream){videoStream.getTracks().forEach(t=>t.stop());videoStream=null;}
}

// ====== –ö–∞–º–µ—Ä–∞ ======
async function startCamera(){
    try{
        if(videoStream){videoStream.getTracks().forEach(t=>t.stop());}
        videoStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}},audio:false});
        document.getElementById('video').srcObject=videoStream;
        goToStep(2);
    }catch(e){console.error(e);showMsg('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É','error');goToStep(1);}
}

// ====== –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ ======
function takePhoto(){
    const video=document.getElementById('video');
    const canvas=document.createElement('canvas');
    canvas.width=video.videoWidth;canvas.height=video.videoHeight;
    const ctx=canvas.getContext('2d');
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    const dataUrl=canvas.toDataURL('image/jpeg',0.9);
    photos.push(dataUrl);
    renderPhotos();
    goToStep(3);
}

// ====== –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ ======
function renderPhotos(){
    const list=document.getElementById('photoList');
    list.innerHTML='';
    photos.forEach((p,i)=>{
        const img=document.createElement('img');
        img.src=p;
        list.appendChild(img);
    });
}

// ====== –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ ======
async function sendPhotos(){
    const name=document.getElementById('userName').value||'–ì–æ—Å—Ç—å';
    const comment=document.getElementById('comment').value||'';
    showMsg('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ...');
    const loader=document.getElementById('loader');loader.style.display='block';
    try{
        for(const p of photos){
            await fetch(GOOGLE_SCRIPT_URL,{method:'POST',body:JSON.stringify({photo:p,name:name,comment:comment}),headers:{'Content-Type':'application/json'}});
        }
        loader.style.display='none';
        photos=[];renderPhotos();
        goToStep(4);
    }catch(e){
        console.error(e);loader.style.display='none';
        showMsg('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏','error');
    }
}
</script>
</body>
</html>
